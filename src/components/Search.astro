---
// Importation de la bibliothèque Howler.js pour la lecture audio
import howler from "howler";

// Fonction pour chercher des titres dans l'API Audius
async function searchTracks(query) {
  const response = await fetch(
    `https://api.audius.co/v1/tracks/search?query=${query}`
  );
  const data = await response.json();
  return data.data;
}

// Fonction pour afficher les résultats de la recherche
function displayResults(tracks) {
  const resultsList = document.getElementById("results");
  resultsList.innerHTML = "";
  for (const track of tracks) {
    const listItem = document.createElement("li");
    listItem.innerHTML = `${track.title} - ${track.user.handle}`;
    resultsList.appendChild(listItem);

    // Configuration du lecteur audio pour chaque chanson
    const audioElement = document.createElement("audio");
    audioElement.src = track.streamUrl;
    audioElement.id = track.id;
    audioElement.preload = "auto";
    listItem.appendChild(audioElement);

    // Gestionnaire de clic pour lire la chanson
    listItem.addEventListener("click", () => {
      const audio = howler.create({ src: [audioElement.src] });
      audio.play();
    });
  }
}

// Gestionnaire de clic pour le bouton de recherche
const searchButton = document.getElementById("search-button");
searchButton.addEventListener("click", async () => {
  const query = document.getElementById("search-input").value.trim();
  if (query) {
    const tracks = await searchTracks(query);
    displayResults(tracks);
  }
});
---

<div>
  <h1>Audius Search</h1>
  <input type="text" id="search-input" placeholder="Search..." />
  <button id="search-button">Search</button>
  <ul id="results"></ul>
</div>
